/*
 * Duck Creek TaskBar JavaScript
 */
Ext.define("DCT.Mvc.PolicyNotesTaskbarGroup",{extend:"DCT.Mvc.TaskbarGroup",xtype:"dctmvcpolicynotestaskbargroup",text:DCT.T("Notes_noColon"),icon:"assets/taskbargroups/dctpolicy/img/note.png",menu:{xtype:"dctmvcpolicynotestaskbargroupmenu"},controllerUrl:"notes/",emptyItemsData:{message:DCT.T("NoCommentsMessage")},deleteNote:function(b,d){var c=this;var a=c.findParentByType("dctmvcpolicynotestaskbargroup");a.confirmAction(DCT.T("AreYouSure"),DCT.T("AreYouSureDeleteNote"),a.doDeleteNote,a)},doDeleteNote:function(b){var c=this;if(b=="yes"){var e=c.activeMenuItem;var d=c.activeMenuItem.initialConfig.data;var a="notes/delete";Ext.Ajax.request({url:a,method:"POST",params:{commentId:d.commentId,commentLockingTS:d.commentLockingTS},success:function(f,h){var g=DCT.Mvc.Util.processAjaxResponse(Ext.decode(f.responseText));if(g.wasSuccessful()){c.menu.hideFlyout();c.menu.panel.remove(e.id,true);if(c.menu.panel.items.getCount()<1){c.menu.panel.setEmptyItemsPanel()}WorkbenchToolbar.hub.fireEvent("refreshnotes")}},failure:function(f,g){}})}}});Ext.define("DCT.Mvc.PolicyNotesTaskbarGroupMenu",{extend:"DCT.Mvc.TaskbarGroupMenu",xtype:"dctmvcpolicynotestaskbargroupmenu",setFlyoutConfigs:function(){return[{xtype:"dctmvcpolicynotestaskbargroupmenudetailsflyout"},{xtype:"dctmvcpolicynotestaskbargroupmenuaddnoteflyout"}]},setMenuPanelXtype:function(){return"dctmvcpolicynotestaskbargroupmenupanel"}});Ext.define("DCT.Mvc.PolicyNotesTaskbarGroupMenuDetailsFlyout",{extend:"DCT.Mvc.TaskbarGroupMenuFlyout",xtype:"dctmvcpolicynotestaskbargroupmenudetailsflyout",bbar:[{xtype:"tbfill"}],cls:"dct-policynotes-flyout",layout:"border",reference:"flyoutDetails",referenceHolder:true,title:DCT.T("NoteDetails"),tools:[{type:"close",itemId:"Close",qtip:DCT.T("Close"),callback:function(a,b,c){a.taskbarGroup.menu.hideFlyout()}}],width:300,height:400,tplCommentText:new Ext.XTemplate('<div class="tskbr-g-m-i-wrapper"><div class="tskbr-g-m-i-primary x-selectable"><tpl if="commentTypeCode == &quot;CI&quot;"><img align="right" src="assets/taskbargroups/dctpolicy/img/page_key.png" alt="{[DCT.T("CommentIsInternal")]}" title="{[DCT.T("CommentIsInternal")]}"></tpl>{commentText}</div></div>').compile(),tplDetails:new Ext.XTemplate('<div class="tskbr-g-m-i-wrapper"><div class="tskbr-g-m-i-primary">{[DCT.T("TransactionStatus")]}: {policyStatus} - {type} - {transactionStatus}</div><div class="tskbr-g-m-i-secondaryleft">{[this.formatDate(values.creationDateTime)]}</div><div class="tskbr-g-m-i-secondaryright">{originator}</div><div class="x-clear"></div></div>',{formatDate:function(d){var c=Ext.getDom("_hiddenExtJsDateformat").value;var b=new Date.parseDate(d,"Y-m-d H:i");var a=b.format(c+", g:i a");return a}}).compile(),constructor:function(a){var b=this;b.callParent([a]);b.buildPanel(a);b.addDeleteNoteButton()},update:function(){var a=this,b=a.taskbarGroup.activeMenuItem.initialConfig.data,d=a.lookupReference("regionSouth"),c=a.lookupReference("regionCenter");d.update(b);c.update(b)},addDeleteNoteButton:function(){var c=this;var a=c.setDeleteNoteButtonConfig();if(a!=false){var b=c.getDockedItems('toolbar[dock="bottom"]');if(!Ext.isEmpty(b)){b[0].add(a)}}},buildPanel:function(a){var b=this;b.add({scrollable:true,layout:"fit",region:"south",reference:"regionSouth",tpl:b.tplDetails});b.add({scrollable:true,region:"center",layout:"fit",reference:"regionCenter",tpl:b.tplCommentText})},setDeleteNoteButtonConfig:function(){var a=this;if(a.taskbarGroup.userHasPrivilege("CanDeleteNote")){return{xtype:"button",reference:"btnDeleteNote",handler:a.taskbarGroup.deleteNote,icon:"assets/taskbargroups/dctpolicy/img/note_delete.png",text:DCT.T("Delete")}}else{return false}}});Ext.define("DCT.Mvc.PolicyNotesTaskbarGroupMenuAddNoteFlyout",{extend:"DCT.Mvc.TaskbarGroupMenuFlyout",xtype:"dctmvcpolicynotestaskbargroupmenuaddnoteflyout",cls:"dct-policynotes-flyout",reference:"flyoutAddNote",referenceHolder:true,title:DCT.T("AddANote"),tools:[{type:"close",itemId:"Close",qtip:DCT.T("Close"),callback:function(b,c,d){var a=b.lookupReference("formPanel");b.resetAndCloseFormPanel(a)}}],width:320,constructor:function(a){var b=this;b.callParent([a]);b.buildForm(a)},buildForm:function(c){var d=this;var a=[];a[0]={xtype:"textarea",height:240,style:{"margin-top":"10px"},stripCharsRe:/(^\s+)/g,maxLength:1000,name:"commentText",allowBlank:false};if(this.taskbarGroup.userHasPrivilege("CanAddInternalNote")){a[1]={xtype:"checkbox",boxLabel:DCT.T("InternalOnly"),name:"commentIsInternal",style:{"margin-left":"6px"},inputValue:true}}var b=new Ext.FormPanel({hideLabels:true,reference:"formPanel",defaults:{anchor:"95%"},monitorValid:true,padding:5,items:a,buttons:[{text:DCT.T("Save"),formBind:true,handler:function(){var e=b;b.mask(DCT.T("Processing"));Ext.Ajax.request({url:d.taskbarGroup.controllerUrl+"add",method:"POST",params:e.getForm().getFieldValues(false),success:function(f,h){b.unmask();var g=DCT.Mvc.Util.processAjaxResponse(Ext.decode(f.responseText));if(g.wasSuccessful()){d.taskbarGroup.menu.panel.refreshItems();d.resetAndCloseFormPanel(e)}WorkbenchToolbar.hub.fireEvent("refreshnotes")},failure:function(f,g){b.unmask()}})}},{text:DCT.T("Cancel"),handler:function(){d.resetAndCloseFormPanel(b)}}]});d.add(b)},resetAndCloseFormPanel:function(a){var b=this;a.getForm().reset();b.taskbarGroup.menu.hideFlyout()}});Ext.define("DCT.Mvc.PolicyNotesTaskbarGroupMenuPanel",{extend:"DCT.Mvc.TaskbarGroupMenuPanel",xtype:"dctmvcpolicynotestaskbargroupmenupanel",cls:"dct-policynotes-panel",defaultType:"dctmvcpolicynotestaskbargroupmenuitem",scrollable:true,setHeaderText:function(){var a=this;return DCT.T("NotesFor_colon")+" "+a.taskbarGroup.dctReference},setToolbarItems:function(){var b=this;if(b.taskbarGroup.userHasPrivilege("CanAddNote")){var c={autoWidth:false,handler:b.openAddNoteDialog,icon:"assets/taskbargroups/dctpolicy/img/add.png",text:DCT.T("AddANote"),taskbarGroup:b.taskbarGroup};var a=b.getDockedItems('toolbar[dock="top"]');if(!Ext.isEmpty(a)){a[0].add(c)}}},setHubListeners:function(a){var b=this;WorkbenchToolbar.hub.addListener("refreshnotestoolbar",b.refreshItemsOuterScope)},refreshItemsOuterScope:function(){var b=WorkbenchToolbar.child("dctmvcpolicynotestaskbargroup");if(!Ext.isEmpty(b)){var a=b.menu.panel;Ext.Ajax.request({url:b.controllerUrl+"list",method:"GET",success:function(c,e){var d=DCT.Mvc.Util.processAjaxResponse(Ext.decode(c.responseText));if(d.wasSuccessful()){var f=d.payload;if(!f.hasOwnProperty("items")){f.items=[]}a.removeAllItems();b.addItems(f.items);b.scrollTo(f.items)}},failure:function(c,d){}})}},openAddNoteDialog:function(a,d){var b=this;var c=b.taskbarGroup.menu;c.activateFlyout("flyoutAddNote")}});Ext.define("DCT.Mvc.PolicyNotesTaskbarGroupMenuItem",{extend:"DCT.Mvc.TaskbarGroupMenuItem",xtype:"dctmvcpolicynotestaskbargroupmenuitem",tpl:new Ext.XTemplate('<div class="tskbr-g-m-i-wrapper"><div class="tskbr-g-m-i-primary"><tpl if="commentTypeCode == &quot;CI&quot;"><img align="right" src="assets/taskbargroups/dctpolicy/img/page_key.png" alt="{[DCT.T("CommentIsInternal")]}" title="{[DCT.T("CommentIsInternal")]}"></tpl>{[fm.ellipsis(values.commentText, 120)]}</div><div class="tskbr-g-m-i-secondaryleft">{[this.formatDate(values.creationDateTime)]}</div><div class="tskbr-g-m-i-secondaryright">{originator}</div><div class="x-clear"></div></div>',{formatDate:function(d){var c=Ext.getDom("_hiddenExtJsDateformat").value;var b=Ext.Date.parse(d,"Y-m-d H:i");var a=Ext.Date.format(b,c+", g:i a");return a}}).compile(),handleOnClick:function(){var a=this;var b=a.taskbarGroup.menu;b.activateFlyout("flyoutDetails");b.flyout.update()}});