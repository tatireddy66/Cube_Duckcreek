/*
 * Duck Creek TaskBar JavaScript
 */
Ext.namespace("DCT.Mvc");Ext.define("DCT.Mvc.Taskbar",{extend:"Ext.Toolbar",defaultType:"dctmvctaskbargroup",xtype:"dctmvctaskbar",controllerUrl:"",pollingFrequencyInSeconds:5,transId:"",constructor:function(a){var b=this;b.setListeners(a);b.callParent([a]);b.appendBaseClass();b.checkForTaskbarGroups()},setListeners:function(a){var b=this;a.listeners={afterrender:{fn:function(){var c=this;DCT.hubEvents.addListener("ajaxcomplete",c.reloadToolbar,c)},scope:b},destroy:{fn:function(){var c=this;DCT.hubEvents.removeListener("ajaxcomplete",c.reloadToolbar,c)},scope:b}}},reloadToolbar:function(){var a=this;if(!a.transId||!Ext.Ajax.isLoading(a.transId)){a.removeAll(true);a.setTaskbarGroups()}},appendBaseClass:function(){var a=this;if(Ext.isEmpty(a.cls)){a.cls="taskbar"}else{a.cls="taskbar "+a.cls}},checkForTaskbarGroups:function(){var a=this;if(a.items.length<1){if(!a.transId){a.setTaskbarGroups()}}else{a.show();return false}},createAddGroupsWithItemsDelegate:function(c){var b=this;var a=[];a[0]=c;return Ext.Function.createDelayed(b.addGroupsWithItems,0,b,a)},addGroupsWithItems:function(b){var a=this;Ext.each(b,function(e,c){var d=a.add(e);d.addItems(e.items);a.updateLayout()})},extractResourcesFromConfig:function(a,b,c){Ext.each(c.resources,function(f,d){var g=f.path.substr(f.path.lastIndexOf(".")+1);if(g==="js"){a.push(f.path)}else{if(g==="css"){var e="link[href="+f.path+"]";if(Ext.isEmpty(Ext.dom.Query.select(e))){b.push(f.path)}}}})},pollForTaskbarGroups:function(){var a=this;if(a.items.length<1){Ext.TaskMgr.start({run:a.checkForTaskbarGroups,interval:a.pollingFrequencyInSeconds*1000,args:arguments,scope:a})}},setTaskbarGroups:function(){var c=this;var a=[];var b=[];c.transId=Ext.Ajax.request({url:c.controllerUrl+"listgroups",method:"GET",params:{configuredGroups:c.configuredGroups},success:function(d,g){var h=Ext.decode(d.responseText);if(h.length>0){Ext.each(h,function(j,i){c.extractResourcesFromConfig(a,b,j)});var f=c.createAddGroupsWithItemsDelegate(h);Ext.Loader.loadScript({url:a,onLoad:f,scope:c});if(!Ext.isEmpty(b)){var e=document.getElementsByTagName("head")[0];Ext.each(b,function(i){var j=document.createElement("link");j.setAttribute("rel","stylesheet");j.setAttribute("type","text/css");j.setAttribute("href",i);e.appendChild(j)})}c.show()}else{if(!c.hidden){c.hide()}}},failure:function(d,e){}})}});Ext.define("DCT.Mvc.TaskbarGroup",{extend:"Ext.Button",xtype:"dctmvctaskbargroup",menu:{xtype:"dctmvctaskbargroupmenu"},activeMenuItem:null,callingController:"",controllerUrl:"",emptyItemsData:{message:DCT.T("NoItemsMessage")},emptyItemsTemplate:new Ext.XTemplate('<div style="text-align:center; margin: 60px 0px;">{message}</div>').compile(),privileges:null,taskbar:null,constructor:function(a){var b=this;b.checkControlExists();b.callParent([a]);b.appendBaseClass();b.setTaskbar()},checkControlExists:function(){var b=this;var a=Ext.getCmp(b.id);if(a){if(a.getXType()==b.xtype){a.destroy()}}},addItem:function(c){var b=this;var a=b.menu.panel;if(a){a.add({data:c})}},scrollTo:function(a){return null},addItems:function(b){var c=this;var a=c.menu.panel;if(b.length>0){a.suspendEvents(false);Ext.each(b,function(e,d){c.addItem(e)});if(a){a.resumeEvents();a.updateLayout()}}else{if(a){a.setEmptyItemsPanel()}}},appendBaseClass:function(){var a=this;if(Ext.isEmpty(a.cls)){a.cls="tskbr-group"}else{a.cls="tskbr-group "+a.cls}},confirmAction:function(d,c,b,a){Ext.Msg.show({title:d,msg:c,buttons:Ext.Msg.YESNO,closable:false,cls:"tskbr-msgbox",fn:b,icon:Ext.MessageBox.QUESTION,scope:a})},displayWarningMessage:function(d,c,b,a){Ext.Msg.show({title:d,msg:c,buttons:Ext.Msg.OK,closable:false,cls:"tskbr-msgbox",fn:b,icon:Ext.MessageBox.WARNING,scope:a})},setTaskbar:function(){var a=this;a.taskbar=a.findParentByType("dctmvctaskbar")},userHasPrivilege:function(a){var b=this;if(b.privileges!=null&&b.privileges.hasOwnProperty(a)){return b.privileges[a]}else{return false}}});Ext.define("DCT.Mvc.TaskbarGroupMenu",{extend:"Ext.menu.Menu",xtype:"dctmvctaskbargroupmenu",enableScrolling:false,forceLayout:true,keyNav:{disable:function(){}},plain:true,shadow:false,showSeparator:false,taskbarGroup:null,useFlyout:true,wrapperHeight:400,wrapperWidth:250,panelWidth:248,referenceHolder:true,flyout:null,constructor:function(a){var b=this;b.setListeners(a);b.callParent([a]);b.appendBaseClass();b.setTaskbarGroup();b.buildMenu();b.setWrapper();b.setPanel()},appendBaseClass:function(){var a=this;if(Ext.isEmpty(a.cls)){a.cls="tskbr-g-menu"}else{a.cls="tskbr-g-menu "+a.cls}},buildMenu:function(){var c=this;var b=[c.buildMenuPanelConfig()];var a=b.concat(c.setFlyoutConfigs());c.add({xtype:c.setMenuWrapperXtype(),height:c.wrapperHeight,width:c.wrapperWidth,items:a})},setPanel:function(){var b=this,a=b.lookupReference("panel");if(a){b.panel=a}},setWrapper:function(){var a=this,b=a.lookupReference("wrapper");if(b){a.wrapper=b}},setFlyout:function(a){var c=this,b=c.lookupReference(a);if(b){c.flyout=b}},setFlyoutConfigs:function(){return[{xtype:"dctmvctaskbargroupmenuflyout"}]},buildMenuPanelConfig:function(){var a=this;return{width:a.panelWidth,xtype:a.setMenuPanelXtype()}},hideFlyout:function(d,a){var b=this,c=(typeof event!="undefined"&&event!=null)?event.type:Ext.EventObject.type;if(Ext.isDefined(d)&&c=="focusout"){return false}if(b.flyout&&!b.flyout.hidden){b.flyout.hide();b.wrapper.setWidth(b.panel.getWidth())}},activateFlyout:function(a){var b=this;b.hideFlyout();b.setFlyout(a);b.showFlyout()},setListeners:function(a){var b=this;a.listeners={beforehide:{fn:b.hideFlyout,scope:b}}},setMenuPanelXtype:function(){return"dctmvctaskbargroupmenupanel"},setMenuWrapperXtype:function(){return"dctmvctaskbargroupmenuwrapper"},setTaskbarGroup:function(){var a=this;a.taskbarGroup=a.findParentByType("dctmvctaskbargroup")},showFlyout:function(){var a=this;if(a.flyout&&a.flyout.hidden){a.flyout.show();a.wrapper.setWidth(a.panel.getWidth()+a.flyout.getWidth())}},privates:{doDestroyFocusableContainer:function(){var a=this;if(a.keyNav&&a.keyNav.destroy){a.keyNav.destroy()}if(a.focusableContainerMouseListener){a.focusableContainerMouseListener.destroy()}a.focusableKeyNav=a.focusableContainerMouseListener=null}}});Ext.define("DCT.Mvc.TaskbarGroupMenuWrapper",{extend:"Ext.Panel",xtype:"dctmvctaskbargroupmenuwrapper",bodyCls:"taskbr-dropdown",layout:{type:"hbox",align:"stretch",pack:"start"},reference:"wrapper",constructor:function(a){var b=this;b.callParent([a]);b.appendBaseClass()},appendBaseClass:function(){var a=this;if(Ext.isEmpty(a.cls)){a.cls="tskbr-g-m-wrapper"}else{a.cls="tskbr-g-m-wrapper "+a.cls}}});Ext.define("DCT.Mvc.TaskbarGroupMenuFlyout",{extend:"Ext.Panel",xtype:"dctmvctaskbargroupmenuflyout",hidden:true,width:240,taskbarGroup:null,constructor:function(a){var b=this;b.callParent([a]);b.appendBaseClass();b.setTaskbarGroup()},appendBaseClass:function(){var a=this;if(Ext.isEmpty(a.cls)){a.cls="tskbr-g-m-flyout"}else{a.cls="tskbr-g-m-flyout "+a.cls}},setTaskbarGroup:function(){var a=this;a.taskbarGroup=a.findParentByType("dctmvctaskbargroup")}});Ext.define("DCT.Mvc.TaskbarGroupMenuPanel",{extend:"Ext.Panel",xtype:"dctmvctaskbargroupmenupanel",scrollable:true,defaultType:"dctmvctaskbargroupmenuitem",forceLayout:true,reference:"panel",tbar:[{xtype:"tbfill"}],tools:[{type:"refresh",itemId:"refresh",qtip:DCT.T("Refresh"),callback:function(a,b,c){a.refreshItems()}}],taskbarGroup:null,constructor:function(a){var b=this;b.checkControlExists();b.callParent([a]);b.appendBaseClass();b.setTaskbarGroup();b.setHeader();b.setToolbarItems();b.setHubListeners(a)},checkControlExists:function(){var b=this;var a=Ext.getCmp(b.id);if(a){if(a.getXType()==b.xtype){a.destroy()}}},appendBaseClass:function(){var a=this;if(Ext.isEmpty(a.cls)){a.cls="tskbr-g-m-panel"}else{a.cls="tskbr-g-m-panel "+a.cls}},refreshItems:function(){var b=this;var a=b.taskbarGroup;Ext.Ajax.request({url:a.controllerUrl+"list",method:"GET",success:function(c,e){var d=DCT.Mvc.Util.processAjaxResponse(Ext.decode(c.responseText));if(d.wasSuccessful()){var f=d.payload;if(!f.hasOwnProperty("items")){f.items=[]}b.removeAllItems();a.addItems(f.items);a.scrollTo(f.items)}},failure:function(c,d){}})},setHubListeners:function(a){},setEmptyItemsPanel:function(){var a=this;a.add({xtype:"container",tpl:a.taskbarGroup.emptyItemsTemplate,data:a.taskbarGroup.emptyItemsData})},removeAllItems:function(){var a=this;a.suspendEvents(false);a.removeAll(true);a.resumeEvents()},setHeader:function(){var b=this;var a=b.setHeaderData();var c=b.setHeaderTpl();b.title=c.apply(a)},setHeaderData:function(){var a=this;return{icon:a.setHeaderIcon(),text:a.setHeaderText()}},setHeaderIcon:function(){var a=this;return a.taskbarGroup.icon},setHeaderText:function(){var a=this;return a.taskbarGroup.label},setHeaderTpl:function(){return new Ext.XTemplate('<img src="{icon}" alt="{text}" title="{text}" /><span>{text}</span>').compile()},setTaskbarGroup:function(){var a=this;a.taskbarGroup=a.findParentByType("dctmvctaskbargroup")},setToolbarItems:function(){}});Ext.define("DCT.Mvc.TaskbarGroupMenuItem",{extend:"Ext.Container",xtype:"dctmvctaskbargroupmenuitem",forceLayout:true,scrollable:true,tpl:new Ext.XTemplate("{html}").compile(),taskbarGroup:null,constructor:function(a){var b=this;b.callParent([a]);b.appendBaseClass();b.setTaskbarGroup();b.configureHandler()},appendBaseClass:function(){var a=this;if(Ext.isEmpty(a.cls)){a.cls="tskbr-g-m-item"}else{a.cls="tskbr-g-m-item "+a.cls}},configureHandler:function(){var a=this;a.addListener("render",function(){if(a.flyout!=null){a.el.on("click",a.runOnClickWithFlyout,a,{scope:a})}else{a.el.on("click",a.runOnClick,a,{scope:a})}},a)},handleOnClick:function(){},runOnClick:function(){var a=this;a.setActiveMenuItem(a);a.handleOnClick()},runOnClickWithFlyout:function(){var a=this;a.setActiveMenuItem(a);var b=a.taskbarGroup.menu;if(!b.flyout.hidden){b.hideFlyout()}a.handleOnClick(a);b.showFlyout()},setActiveMenuItem:function(a){var b=this;b.taskbarGroup.activeMenuItem=a},setTaskbarGroup:function(){var a=this;a.taskbarGroup=a.findParentByType("dctmvctaskbargroupmenu").taskbarGroup}});Ext.define("DCT.Mvc.AjaxResponse",{constructor:function(a){var b=this;Ext.apply(b,a,{code:null,message:null,payload:null,success:false})},wasSuccessful:function(){var a=this;return(a.code==200)?true:false},sessionHasExpired:function(){var a=this;return(a.code==510)?true:false}});DCT.Mvc.Util={processAjaxResponse:function(b){var a=new DCT.Mvc.AjaxResponse(b);if(a.sessionHasExpired()){DCT.Submit.submitPage("logout")}return a},stringCompare:function(c,b,a){if(arguments.length==2){a=true}if(a){return c==b}return c.toLowerCase()==b.toLowerCase()}};Ext.define("DCT.Mvc.IconModel",{extend:"Ext.data.Model",fields:[{name:"ext",type:"string"},{name:"file",type:"string"}]});Ext.define("DCT.Mvc.IconManager",{extend:"Ext.data.ArrayStore",xtype:"dctMvcIconManager",autoLoad:true,storeId:"iconStore",model:"DCT.Mvc.IconModel",data:[["pdf","page_white_acrobat.png"],["u3d","page_white_acrobat.png"],["pfb","page_white_acrobat.png"],["doc","page_white_word.png"],["docx","page_white_word.png"],["rtx","page_white_word.png"],["wpd","page_white_word.png"],["wps","page_white_word.png"],["xlr","page_white_excel.png"],["xls","page_white_excel.png"],["xlsx","page_white_excel.png"],["xml","page_white_text.png"],["txt","page_white_text.png"],["text","page_white_text.png"],["bmp","page_white_picture.png"],["gif","page_white_picture.png"],["jpg","page_white_picture.png"],["png","page_white_picture.png"],["jpeg","page_white_picture.png"],["tif","page_white_picture.png"],["eps","page_white_picture.png"],["ps","page_white_picture.png"],["svg","page_white_picture.png"],["7z","page_white_compressed.png"],["deb","page_white_compressed.png"],["tif","page_white_compressed.png"],["gz","page_white_compressed.png"],["zip","page_white_compressed.png"],["zipx","page_white_compressed.png"],["3g2","page_white_camera.png"],["3gp","page_white_camera.png"],["asf","page_white_camera.png"],["asx","page_white_camera.png"],["avi","page_white_camera.png"],["flv","page_white_camera.png"],["mov","page_white_camera.png"],["mp4","page_white_camera.png"],["mpg","page_white_camera.png"],["rm","page_white_camera.png"],["swf","page_white_camera.png"],["vob","page_white_camera.png"],["wmv","page_white_camera.png"]],constructor:function(a){var b=this;b.callParent([arguments])},getIcon:function(a){var b=this;if(a==false){return"page_white.png"}if(b.getAt(b.find("ext",a))){return b.getAt(b.find("ext",a)).data.file}return"page_white.png"}});